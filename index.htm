<html>
    <head>
        <title>181.fm The Mix - Scrobble to last.fm account</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
        function scrobble(artist, track)
        {
            trackNumber = "";
            duration = "";
            params = "";
            params += "submissionType=track";
            params += "&username=" + encodeURIComponent(document.getElementById("username").value);
            params += "&password=" + encodeURIComponent(document.getElementById("password").value);
            params += "&artist=" + encodeURIComponent(artist);
            params += "&track=" + encodeURIComponent(track);
            params += "&album=";
            params += "&number=" + trackNumber;
            params += "&duration=" + duration;
            $.ajax({
                url: "http://universalscrobbler.invitationstation.org/scrobble.php",
                dataType: 'json',
                data: params,
                success: true
            });
        }
        </script>
        <script type="text/javascript">
        function setLogin(){
            var usernameLogin = document.getElementById('username').value;
            var passwordLogin = document.getElementById('password').value;
            var field = document.createElement('div');
            field.setAttribute('type','hidden');
            field.setAttribute('id','hiddenuser');
            field.setAttribute('value',usernameLogin);
            document.getElementById('signin').appendChild(field);
            var field = document.createElement('div');
            field.setAttribute('type','hidden');
            field.setAttribute('id','hiddenpassword');
            field.setAttribute('value',passwordLogin);
            document.getElementById('signin').appendChild(field);
            $("#login").hide();
            $("#signin").show();
            document.getElementById('currentUser').innerHTML = usernameLogin;
        }
        
        function logout(){
            $("hiddenuser").remove();
            $("hiddenpassword").remove();
            $("#signin").hide();
            $("#login").show();
        }
        </script>
        <script>
        $(function(){
            var i = 0;
            var remove = true;
            
            $('#scrobbleBuff').click(function(e) {
                $('<div/>').attr({
                    'id' : "track"+i
                }).addClass('trackBuff')
                  .appendTo('#scrobbleArea')
                  .text("hello")
                i++;
            });
                    
            
            $('#scrobbleArea').on('click','.trackBuff',function (){
                if(remove){
                    $(this).remove();
                    }
            });
        });
        </script>
    </head>
    <body>
        <div id="header">
            <div id="lastfm"><img src="images/lastfm.jpg" alt="last.fm" /></div>
            <div id="headerText">scrobbling for 181.fm</div>
        </div>
        <div id="login" style="display: block;">
            <div class="loginsection">
            <label class="loginsectionhor">last.fm username</label>
            <input id="username" name="username" type="text" value="SampleUsername" />
            </div>
            <div class="loginsection">
            <label class="loginsectionhor">password</label>
            <input id="password" name="password" type="password" value="SamplePassword" />
            </div>
            <div id="setLoginWrapper">
            <div id="setLogin" onclick=setLogin();>Login</div>
            </div>
        </div>
        <div id="signin" style="display: none;">
        <label>Signed in as</label>
        <div id="currentUser">SampleCurrentUser</div>
        <a id="logout" href="" onclick="logout();">Logout</a>
        </div>
        <div id="content">
            <div id="trackinfobox">
                <div id="nowPlayingTrack">Now Playing</div>
                <div id="artist">Sample Artist</div>
                <div id="seperator">&nbsp;-&nbsp;</div>
                <div id="trackName">Sample Track</div>
            </div>
            <iframe id="theMixNowPlaying" name="theMixNowPlaying" src="fetchCurrentSong.php" width="0" height="0" frameborder=0></iframe>
        </div>
        <span id="scrobbleArea"></span>
        <div id="footer">
        </div>
        <script>
        setInterval(recordPlaylist,1000);
        var trackBuffCount = 0;
        var track = new Array();
        track[trackBuffCount-1] = document.getElementById('trackName').innerHTML;
                
        function recordPlaylist(){
            // look for change in title track
            var currentArtist = document.getElementById('artist').innerHTML;
            var currentTrack = document.getElementById('trackName').innerHTML;

            track[trackBuffCount] = currentTrack;
            
            // comparison of current track and prev track
            if(track[trackBuffCount] != track[trackBuffCount-1]){
            
            // if change found, put in scrobble buff
            $(function(){
                  $('<div/>').attr({
                      'id' : "trackInBuff"+ trackBuffCount
                  }).addClass('trackBuff')
                    .appendTo('#scrobbleArea')
                    $('<div/>').attr({
                                'id' : "artistBlock"+ trackBuffCount
                              }).addClass('artistNameInBuff')
                                .appendTo('#trackInBuff' + trackBuffCount)
                                .text(currentArtist)
                    $('<div/>').attr({
                                'id' : "seperatorBlock"+ trackBuffCount
                              }).addClass('seperatorInBuff')
                                .appendTo('#trackInBuff' + trackBuffCount)
                                .text("-")
                    $('<div/>').attr({
                                'id' : "trackBlock"+ trackBuffCount
                              }).addClass('trackBlockInBuff')
                                .appendTo('#trackInBuff' + trackBuffCount)
                                .text(currentTrack)
                     $('<a/>').attr({
                                'href' : "#"
                              }).appendTo('#trackInBuff' + trackBuffCount)
                                .append('<span class="makeLink"></span>')
                  trackBuffCount++;
                  });
             };
        };
        
        // scrobble local track
        $('#scrobbleArea').on('click','.makeLink',function (){
                var artist = this.parentNode.parentNode.children[0].innerHTML
                var track = this.parentNode.parentNode.children[2].innerHTML
                scrobble(artist, track)
        });
        </script>
    </body>
</html>